<script type="text/javascript">

	const electron = window.require('electron');
	const ipcRenderer  = electron.ipcRenderer;
	var axios = require('axios');

	const baseUrl = 'http://localhost';

	let userId = -1;

	ipcRenderer.on('getRequest', (event, arg) => {
		axios.get(baseUrl, {
		})
		.then(function (response) {
			ipcRenderer.send('getResult', response.data);
		})
		.catch(function (error) {
			 console.log(error);
		});
	});

	// Register
	ipcRenderer.on('postRegisterRequest', (event, arg) => {
		axios.post(baseUrl+'/register', {
			firstName: 				arg.firstName,
			lastName: 				arg.lastName,
			email: 						arg.email,
			password: 				arg.password,
			password_confirmation: 			arg.confirmPassword,
		})
		.then(function (response) {
			ipcRenderer.send('registerSuccess', response.data);
		})
		.catch(function (error) {
			ipcRenderer.send('registerFailure', error.response.data);
		});
	});

	// Login
	ipcRenderer.on('getLoginRequest', (event, arg) => {
		axios.get(baseUrl+'/login', {
		params: {
				email: 		arg.email,
				password: arg.password,
			}
		})
		.then(function (response) {
			if ( response.data.result.userId && response.data.result.token)
			{
				userId = response.data.result.userId;
				axios.defaults.headers.common['Authorization'] = 'Bearer ' + response.data.result.token;

				// Prep app for initial resource loading
				ipcRenderer.send('loginSuccess');

				// Fetch user basic information
				axios.get(baseUrl+'/users/'+userId
				)
				.then(function (response) {
					ipcRenderer.send('userInfoSuccess', response.data.result);
				})
				.catch(function (error) {
					ipcRenderer.send('setUpFailure');
				});

				// Fetch user roles
				axios.get(baseUrl+'/users/'+userId+'/roles'
				)
				.then(function (response) {
					ipcRenderer.send('userRolesSuccess', response.data.result);
				})
				.catch(function (error) {
					ipcRenderer.send('setUpFailure');
				});
			}
			else 
				ipcRenderer.send('loginFailure', {'message' : {'error' : 'Unable to login.'}});
		})
		.catch(function (error){
				ipcRenderer.send('loginFailure', error.response.data);
		});
	});
 
	// Get anouncements
	ipcRenderer.on('getAnnouncementsRequest', (event, arg) => {
		axios.get(baseUrl+'/announcements')
		.then(function (response) {
			ipcRenderer.send('getAnnouncementsSuccess', response.data);
		})
		.catch(function (error) {
			ipcRenderer.send('getAnnouncementsFailure', error.response.data);
		});

	});
	

	ipcRenderer.on('initialSetUpRequests', (event, arg) => {

		
			
	});

</script>